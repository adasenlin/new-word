<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ä¸–ç•Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿ - å®Œæ•´ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-title {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .demo-info {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
        }

        .demo-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .demo-accounts {
            display: grid;
            gap: 10px;
        }

        .demo-account {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .account-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .account-role {
            font-size: 0.9em;
            color: #ccc;
        }

        .quick-login {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ffd700;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.2);
        }

        .form-input::placeholder {
            color: #ccc;
        }

        .login-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .main-container {
            display: none;
            padding: 20px;
            max-width: 95vw;
            margin: 0 auto;
        }

        .header {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .welcome-text {
            font-size: 1.5em;
            color: #ffd700;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid transparent;
        }

        .welcome-text:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
        }

        .btn-primary { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; }
        .btn-secondary { background: linear-gradient(45deg, #2196F3, #1976D2); color: white; }
        .btn-danger { background: linear-gradient(45deg, #f44336, #d32f2f); color: white; }
        .btn-warning { background: linear-gradient(45deg, #ff9800, #f57c00); color: white; }
        .btn-success { background: linear-gradient(45deg, #8bc34a, #689f38); color: white; }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .employee-panel {
            display: none;
        }

        .admin-panel {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .stat-title {
            color: #ffd700;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            color: #ccc;
            font-size: 0.9em;
        }

        .task-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 1.8em;
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }

        .global-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .progress-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .batch-server-controls {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .batch-server-title {
            color: #ffd700;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .batch-server-row {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .batch-select {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-size: 1em;
            min-width: 200px;
        }

        .batch-select:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.3);
        }

        .collapsible {
            cursor: pointer;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .collapsible:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .collapsible.active {
            background: rgba(255, 215, 0, 0.2);
        }

        .content {
            display: none;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .content.show {
            display: block;
        }

        .server-management-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .server-list-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .server-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .server-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .server-item.selected {
            background: rgba(255, 215, 0, 0.3);
            border: 1px solid #ffd700;
        }

        .server-checkbox {
            margin-right: 10px;
        }

        .batch-textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin: 10px 0;
        }

        .batch-textarea:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.2);
        }

        .batch-textarea::placeholder {
            color: #ccc;
        }

        .management-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        /* æœç´¢å’Œç­›é€‰åŠŸèƒ½æ ·å¼ */
        .search-filter-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .search-filter-title {
            color: #ffd700;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .search-filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-size: 14px;
            width: 100%;
        }

        .search-input:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.2);
        }

        .search-input::placeholder {
            color: #ccc;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-size: 14px;
            width: 100%;
        }

        .filter-select:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.2);
        }

        .search-results-info {
            color: #ffd700;
            font-size: 0.9em;
            text-align: center;
            margin-top: 10px;
        }

        /* å¿«æ·é”®æç¤ºæ ·å¼ */
        .shortcuts-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            display: none;
            max-width: 300px;
        }

        .shortcuts-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .shortcut-key {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .mobile-menu {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            z-index: 1000;
        }

        .mobile-menu-buttons {
            display: flex;
            justify-content: space-around;
            gap: 5px;
        }

        .mobile-btn {
            flex: 1;
            padding: 8px 4px;
            font-size: 0.8em;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        .mobile-btn.active {
            background: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        /* æ•°æ®å¤‡ä»½æ¢å¤æ ·å¼ */
        .backup-restore-section {
            background: rgba(0, 150, 255, 0.1);
            border: 2px solid rgba(0, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .backup-restore-title {
            color: #0096ff;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .backup-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 10px 15px;
            background: rgba(0, 150, 255, 0.2);
            border: 2px solid rgba(0, 150, 255, 0.5);
            border-radius: 8px;
            color: #0096ff;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: rgba(0, 150, 255, 0.3);
        }

        .windows-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            min-height: 600px;
        }

        .window-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            cursor: move;
            transition: all 0.3s ease;
            resize: both;
            min-width: 280px;
            min-height: 400px;
            max-width: 600px;
            max-height: 800px;
            position: relative;
        }

        .window-card:hover {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .window-card.dragging {
            opacity: 0.8;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .window-card.drag-over {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(-45deg, transparent 0%, transparent 40%, #ffd700 40%, #ffd700 60%, transparent 60%);
            cursor: nw-resize;
            z-index: 10;
        }

        .window-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .window-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffd700;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid transparent;
        }

        .window-title:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .window-progress {
            font-size: 0.8em;
            color: #ccc;
        }

        .window-controls {
            display: flex;
            gap: 6px;
        }

        .window-content {
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .zones-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            overflow-x: auto;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .zone-tab {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #ccc;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.85em;
            position: relative;
        }

        .zone-tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: #ffd700;
            border-bottom: 3px solid #ffd700;
        }

        .zone-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .zone-tab-content {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid transparent;
        }

        .zone-tab-content:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .zone-delete-btn {
            margin-left: 6px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: none;
        }

        .zone-tab:hover .zone-delete-btn {
            display: inline-block;
        }

        .zone-add-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .zone-add-btn:hover {
            background: #45a049;
        }

        .zone-content {
            padding: 15px;
            display: none;
            height: calc(100% - 40px);
            overflow-y: auto;
        }

        .zone-content.active {
            display: block;
        }

        .zone-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.85em;
        }

        .zone-progress-info {
            color: #ffd700;
        }

        .server-select-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .server-select-label {
            color: #ffd700;
            font-weight: bold;
            white-space: nowrap;
            font-size: 0.8em;
        }

        .custom-select {
            position: relative;
            display: flex;
            align-items: center;
            flex: 1;
        }

        .select-display {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 6px 10px;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 120px;
            transition: all 0.3s ease;
            font-size: 0.8em;
        }

        .select-display:hover {
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.3);
        }

        .select-arrow {
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid #fff;
            transition: transform 0.3s ease;
        }

        .select-display.open .select-arrow {
            transform: rotate(180deg);
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .select-options.show {
            display: block;
        }

        .select-option {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
        }

        .select-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .select-option.selected {
            background: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        .add-server-input {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 5px;
            padding: 6px 10px;
            color: white;
            font-size: 12px;
            width: 100%;
            margin-bottom: 5px;
        }

        .add-server-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }

        .add-server-input::placeholder {
            color: #ccc;
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .character-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 8px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .character-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .character-card.completed {
            opacity: 0.6;
        }

        .character-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .character-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .character-delete {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .character-card:hover .character-delete {
            opacity: 1;
        }

        .character-server {
            font-size: 0.7em;
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 4px;
            text-align: center;
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .character-name {
            font-weight: bold;
            font-size: 0.85em;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 3px;
            border: 2px solid transparent;
            text-align: center;
        }

        .character-name:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .completed .character-name {
            text-decoration: line-through;
        }

        .add-character-btn {
            background: rgba(76, 175, 80, 0.3);
            border: 2px dashed #4CAF50;
            border-radius: 6px;
            padding: 15px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4CAF50;
            font-weight: bold;
            font-size: 0.8em;
        }

        .add-character-btn:hover {
            background: rgba(76, 175, 80, 0.5);
            border-style: solid;
        }

        .edit-input {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #ffd700;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: inherit;
            font-family: inherit;
            text-align: center;
            width: 100%;
        }

        .edit-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }

        .title-edit-input {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.5em;
            font-family: inherit;
            font-weight: bold;
            text-align: center;
            width: 100%;
        }

        .title-edit-input:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .submit-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-table {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table th {
            background: rgba(255, 255, 255, 0.1);
            color: #ffd700;
            font-weight: bold;
        }

        .performance-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }

        .performance-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .user-management-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .user-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
        }

        .close {
            color: #ccc;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #fff;
        }

        @media (max-width: 1400px) {
            .windows-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1100px) {
            .windows-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .windows-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .windows-container {
                grid-template-columns: 1fr;
            }
            
            .characters-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .mobile-menu {
                display: block;
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }

            .search-filter-controls {
                grid-template-columns: 1fr;
            }

            .backup-controls {
                grid-template-columns: 1fr;
            }

            .shortcuts-panel {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                right: auto;
                max-width: 90vw;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <h1 class="login-title" ondblclick="editSystemTitle()">ğŸ® æ–°ä¸–ç•Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</h1>
            
            <div class="demo-info">
                <div class="demo-title">ğŸ‘¥ å‘˜å·¥è´¦å·</div>
                <div class="demo-accounts" id="demoAccounts">
                    <div class="demo-account">
                        <div class="account-info">
                            <div><strong>admin</strong></div>
                            <div class="account-role">ç³»ç»Ÿç®¡ç†å‘˜</div>
                        </div>
                        <button class="quick-login" onclick="quickLogin('admin', 'admin')">å¿«é€Ÿç™»å½•</button>
                    </div>
                </div>
            </div>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="username">ç”¨æˆ·å</label>
                    <input type="text" id="username" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">å¯†ç </label>
                    <input type="password" id="password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="login-btn">ç™»å½•</button>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç”¨æˆ·é…ç½®</div>
                <span class="close" onclick="closeUserModal()">&times;</span>
            </div>
            <div class="user-form">
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" id="modalUsername" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">å§“å</label>
                    <input type="text" id="modalName" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">éƒ¨é—¨</label>
                    <input type="text" id="modalDepartment" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ç»„æœºæ•°é‡</label>
                    <input type="number" id="modalWindows" class="form-input" min="1" max="10">
                </div>
                <div class="form-group">
                    <label class="form-label">æ¯ç»„æœºå·æœºæ•°</label>
                    <input type="number" id="modalZones" class="form-input" min="1" max="10">
                </div>
                <div class="form-group">
                    <label class="form-label">æ¯å·æœºè§’è‰²æ•°</label>
                    <input type="number" id="modalCharacters" class="form-input" min="1" max="20">
                </div>
            </div>
            <div class="management-buttons">
                <button class="btn btn-primary" onclick="saveUserConfig()">ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="closeUserModal()">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="deleteUser()" id="deleteUserBtn">åˆ é™¤ç”¨æˆ·</button>
            </div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-container" id="mainContainer">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
                <div>
                    <div class="welcome-text" id="welcomeText" ondblclick="editWelcomeText()">æ¬¢è¿å›æ¥ï¼Œ<span id="userName">ç”¨æˆ·</span></div>
                    <div style="color: #ccc; margin-top: 5px;" id="userRole">å‘˜å·¥</div>
                </div>
            </div>
            <div class="header-controls">
                <div style="color: #ffd700;">ä»Šæ—¥ï¼š<span id="currentDate"></span></div>
                <button class="btn btn-danger" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <!-- å‘˜å·¥é¢æ¿ -->
        <div class="employee-panel" id="employeePanel">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">ä»Šæ—¥è¿›åº¦</div>
                    <div class="stat-value" id="todayProgress">0%</div>
                    <div class="stat-subtitle">å·²å®Œæˆä»»åŠ¡æ•°é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">æœ¬æœˆè¿›åº¦</div>
                    <div class="stat-value" id="monthProgress">0%</div>
                    <div class="stat-subtitle">æœˆåº¦å¹³å‡å®Œæˆç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">è¿ç»­å¤©æ•°</div>
                    <div class="stat-value" id="streakDays">0</div>
                    <div class="stat-subtitle">è¿ç»­å®Œæˆä»»åŠ¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">æœ¬æœˆæ’å</div>
                    <div class="stat-value" id="monthRank">#1</div>
                    <div class="stat-subtitle">éƒ¨é—¨å†…æ’å</div>
                </div>
            </div>

            <!-- ä»»åŠ¡é¢æ¿ -->
            <div class="task-panel">
                <div class="panel-title" id="employeePanelTitle" ondblclick="editPanelTitle()">ğŸ¯ æˆ‘çš„ä»»åŠ¡é¢æ¿</div>
                
                <!-- æœç´¢å’Œç­›é€‰åŠŸèƒ½ -->
                <div class="search-filter-section">
                    <div class="search-filter-title">ğŸ” æœç´¢å’Œç­›é€‰</div>
                    <div class="search-filter-controls">
                        <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢è§’è‰²åç§°..." onkeyup="filterCharacters()">
                        <select id="serverFilter" class="filter-select" onchange="filterCharacters()">
                            <option value="">æ‰€æœ‰æœåŠ¡å™¨</option>
                        </select>
                        <select id="statusFilter" class="filter-select" onchange="filterCharacters()">
                            <option value="">æ‰€æœ‰çŠ¶æ€</option>
                            <option value="completed">å·²å®Œæˆ</option>
                            <option value="pending">æœªå®Œæˆ</option>
                        </select>
                        <button class="btn btn-secondary" onclick="clearFilters()">æ¸…é™¤ç­›é€‰</button>
                    </div>
                    <div class="search-results-info" id="searchResultsInfo"></div>
                </div>

                <!-- æ•°æ®å¤‡ä»½æ¢å¤åŠŸèƒ½ -->
                <div class="backup-restore-section">
                    <div class="backup-restore-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
                    <div class="backup-controls">
                        <button class="btn btn-primary" onclick="backupUserData()">ğŸ“¤ å¤‡ä»½æ•°æ®</button>
                        <div class="file-input-wrapper">
                            <input type="file" id="restoreFile" class="file-input" accept=".json" onchange="restoreUserData(event)">
                            <label for="restoreFile" class="file-input-label">ğŸ“¥ æ¢å¤æ•°æ®</label>
                        </div>
                        <button class="btn btn-warning" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                        <button class="btn btn-success" onclick="exportToCSV()">ğŸ“‹ å¯¼å‡ºCSV</button>
                    </div>
                </div>
                
                <div class="global-controls">
                    <button class="btn btn-primary" onclick="selectAllTasks()">ğŸ¯ å…¨é€‰æ‰€æœ‰ä»»åŠ¡</button>
                    <button class="btn btn-secondary" onclick="clearAllTasks()">âŒ æ¸…é™¤æ‰€æœ‰é€‰æ‹©</button>
                    <button class="btn btn-success" onclick="addWindow()">â• æ–°å¢ç»„æœº</button>
                    <button class="btn btn-danger" onclick="resetAllProgress()">ğŸ”„ é‡ç½®ä»Šæ—¥è¿›åº¦</button>
                    <button class="btn btn-warning" onclick="toggleShortcuts()">âŒ¨ï¸ å¿«æ·é”®</button>
                </div>

                <div class="progress-section">
                    <h2>æ€»ä½“è¿›åº¦</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="globalProgress">0/0 (0%)</div>
                    </div>
                </div>

                <div class="batch-server-controls">
                    <div class="batch-server-title">ğŸŒ æ‰¹é‡æœåŠ¡å™¨ç®¡ç†</div>
                    <div class="batch-server-row">
                        <label for="batchServerSelect" style="color: #ffd700; font-weight: bold;">é€‰æ‹©æœåŠ¡å™¨:</label>
                        <select id="batchServerSelect" class="batch-select">
                            <option value="">è¯·é€‰æ‹©è¦æ‰¹é‡åº”ç”¨çš„æœåŠ¡å™¨</option>
                        </select>
                        <button class="btn btn-warning" onclick="applyBatchServer()">ğŸ“‹ åº”ç”¨åˆ°æ‰€æœ‰ç»„æœº</button>
                    </div>
                    
                    <div class="collapsible" onclick="toggleServerManagement()">âš™ï¸ æœåŠ¡å™¨ç®¡ç† (ç‚¹å‡»å±•å¼€/æ”¶èµ·)</div>
                    <div class="content" id="serverManagementContent">
                        <div class="server-management-section">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ“ æ‰¹é‡æ·»åŠ æœåŠ¡å™¨</h4>
                            <textarea id="batchAddServers" class="batch-textarea" placeholder="æ¯è¡Œä¸€ä¸ªæœåŠ¡å™¨åç§°ï¼Œä¾‹å¦‚ï¼š&#10;APâ€”â€”Delos æ¾³æ´²æœ&#10;US Westâ€”â€”Eldorado ç¾è¥¿æœ&#10;EU Centralâ€”â€”Aries æ¬§æ´²æœ"></textarea>
                            <div class="management-buttons">
                                <button class="btn btn-success" onclick="batchAddServers()">â• æ‰¹é‡æ·»åŠ </button>
                                <button class="btn btn-secondary" onclick="loadDefaultServers()">ğŸ”„ æ¢å¤é»˜è®¤æœåŠ¡å™¨</button>
                            </div>
                        </div>
                        
                        <div class="server-management-section">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤æœåŠ¡å™¨</h4>
                            <div style="color: #ccc; font-size: 0.9em; margin-bottom: 10px;">é€‰æ‹©è¦åˆ é™¤çš„æœåŠ¡å™¨ï¼ˆå¯å¤šé€‰ï¼‰:</div>
                            <div class="server-list-container" id="serverListForDeletion">
                                <!-- åŠ¨æ€ç”ŸæˆæœåŠ¡å™¨åˆ—è¡¨ -->
                            </div>
                            <div class="management-buttons">
                                <button class="btn btn-primary" onclick="selectAllServers()">âœ… å…¨é€‰</button>
                                <button class="btn btn-secondary" onclick="deselectAllServers()">âŒ å…¨ä¸é€‰</button>
                                <button class="btn btn-danger" onclick="batchDeleteServers()">ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­</button>
                            </div>
                        </div>
                        
                        <div class="server-management-section">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ“‹ å½“å‰æœåŠ¡å™¨åˆ—è¡¨</h4>
                            <div class="server-list-container" id="currentServerList">
                                <!-- åŠ¨æ€æ˜¾ç¤ºå½“å‰æœåŠ¡å™¨åˆ—è¡¨ -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="windows-container" id="windowsContainer">
                    <!-- åŠ¨æ€ç”Ÿæˆçª—å£ -->
                </div>

                <div class="submit-section">
                    <div style="margin-bottom: 15px; font-size: 1.1em;">
                        âš ï¸ å®Œæˆä»»åŠ¡åè¯·åŠæ—¶æäº¤ï¼Œç®¡ç†å‘˜å°†æ ¹æ®æäº¤è®°å½•è®¡ç®—ç»©æ•ˆ
                    </div>
                    <button class="submit-btn" onclick="submitProgress()">ğŸ“¤ æäº¤ä»Šæ—¥è¿›åº¦</button>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜é¢æ¿ -->
        <div class="admin-panel" id="adminPanel">
            <!-- æ¦‚è§ˆç»Ÿè®¡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">ä»Šæ—¥æ€»ä½“å®Œæˆç‡</div>
                    <div class="stat-value" id="adminTodayProgress">0%</div>
                    <div class="stat-subtitle">æ‰€æœ‰å‘˜å·¥å¹³å‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">æ´»è·ƒå‘˜å·¥</div>
                    <div class="stat-value" id="onlineEmployees">0</div>
                    <div class="stat-subtitle">å·²æäº¤è¿›åº¦äººæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">æœ¬æœˆæœ€ä½³å‘˜å·¥</div>
                    <div class="stat-value" id="bestEmployee">-</div>
                    <div class="stat-subtitle">å®Œæˆç‡æœ€é«˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">å›¢é˜Ÿæ€»ä»»åŠ¡</div>
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-subtitle">ä»Šæ—¥åˆ†é…ä»»åŠ¡æ•°</div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div class="user-management-panel">
                <div class="panel-title">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</div>
                <div class="user-form">
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·å</label>
                        <input type="text" id="newUsername" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å§“å</label>
                        <input type="text" id="newName" class="form-input" placeholder="è¯·è¾“å…¥å§“å">
                    </div>
                    <div class="form-group">
                        <label class="form-label">éƒ¨é—¨</label>
                        <input type="text" id="newDepartment" class="form-input" placeholder="è¯·è¾“å…¥éƒ¨é—¨">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¯†ç </label>
                        <input type="password" id="newPassword" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç»„æœºæ•°é‡</label>
                        <input type="number" id="newWindows" class="form-input" placeholder="1-10" min="1" max="10" value="3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¯ç»„æœºå·æœºæ•°</label>
                        <input type="number" id="newZones" class="form-input" placeholder="1-10" min="1" max="10" value="2">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¯å·æœºè§’è‰²æ•°</label>
                        <input type="number" id="newCharacters" class="form-input" placeholder="1-20" min="1" max="20" value="5">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success" onclick="createUser()">â• åˆ›å»ºç”¨æˆ·</button>
                    </div>
                </div>
            </div>

            <!-- å‘˜å·¥è¿›åº¦è¡¨ -->
            <div class="admin-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th>å‘˜å·¥å§“å</th>
                            <th>ç”¨æˆ·å</th>
                            <th>éƒ¨é—¨</th>
                            <th>ä»»åŠ¡é…ç½®</th>
                            <th>ä»Šæ—¥è¿›åº¦</th>
                            <th>æœ¬æœˆå®Œæˆç‡</th>
                            <th>æœ€åæäº¤æ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                        <!-- åŠ¨æ€ç”Ÿæˆå‘˜å·¥æ•°æ® -->
                    </tbody>
                </table>
            </div>

            <!-- ç®¡ç†æ“ä½œ -->
            <div class="task-panel">
                <div class="panel-title">ğŸ“Š ç®¡ç†å·¥å…·</div>
                <div class="global-controls">
                    <button class="btn btn-primary" onclick="exportReport()">ğŸ“ˆ å¯¼å‡ºæŠ¥è¡¨</button>
                    <button class="btn btn-secondary" onclick="resetAllEmployeeProgress()">ğŸ”„ é‡ç½®æ‰€æœ‰è¿›åº¦</button>
                    <button class="btn btn-warning" onclick="backupData()">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                    <button class="btn btn-success" onclick="calculatePerformance()">ğŸ’° è®¡ç®—ç»©æ•ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å¿«æ·é”®æç¤ºé¢æ¿ -->
    <div class="shortcuts-panel" id="shortcutsPanel">
        <div class="shortcuts-title">âŒ¨ï¸ å¿«æ·é”®</div>
        <div class="shortcut-item">
            <span>å…¨é€‰ä»»åŠ¡</span>
            <span class="shortcut-key">Ctrl+A</span>
        </div>
        <div class="shortcut-item">
            <span>æ¸…é™¤é€‰æ‹©</span>
            <span class="shortcut-key">Ctrl+D</span>
        </div>
        <div class="shortcut-item">
            <span>ä¿å­˜è¿›åº¦</span>
            <span class="shortcut-key">Ctrl+S</span>
        </div>
        <div class="shortcut-item">
            <span>æäº¤è¿›åº¦</span>
            <span class="shortcut-key">Ctrl+Enter</span>
        </div>
        <div class="shortcut-item">
            <span>æœç´¢</span>
            <span class="shortcut-key">Ctrl+F</span>
        </div>
        <div class="shortcut-item">
            <span>æ–°å¢ç»„æœº</span>
            <span class="shortcut-key">Ctrl+N</span>
        </div>
        <div class="shortcut-item">
            <span>æ˜¾ç¤º/éšè—å¿«æ·é”®</span>
            <span class="shortcut-key">F1</span>
        </div>
        <div class="shortcut-item">
            <span>é€€å‡ºç™»å½•</span>
            <span class="shortcut-key">Ctrl+Q</span>
        </div>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå• -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-buttons">
            <button class="mobile-btn active" onclick="switchMobileTab('tasks')">ä»»åŠ¡</button>
            <button class="mobile-btn" onclick="switchMobileTab('servers')">æœåŠ¡å™¨</button>
            <button class="mobile-btn" onclick="switchMobileTab('backup')">å¤‡ä»½</button>
            <button class="mobile-btn" onclick="switchMobileTab('stats')">ç»Ÿè®¡</button>
        </div>
    </div>

    <script>
        // ç³»ç»Ÿæ•°æ®
        let systemData = {
            systemTitle: 'ğŸ® æ–°ä¸–ç•Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿ',
            users: {
                admin: {
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    role: 'admin',
                    password: 'admin',
                    department: 'ç®¡ç†éƒ¨'
                }
            },
            serverList: [
                'APâ€”â€”Delos æ¾³æ´²æœ',
                'US Westâ€”â€”Eldorado ç¾è¥¿æœ', 
                'US Eastâ€”â€”Valhalla ç¾ä¸œæœ',
                'EU Centralâ€”â€”Aries æ¬§æ´²æœ'
            ]
        };

        let currentUser = null;
        let currentDate = new Date().toLocaleDateString('zh-CN');
        let gameData = {};
        let progress = {};
        let windowOrder = [];
        let draggedElement = null;
        let panelTitle = 'ğŸ¯ æˆ‘çš„ä»»åŠ¡é¢æ¿';
        let welcomeMessage = 'æ¬¢è¿å›æ¥';
        let filteredCharacters = []; // å­˜å‚¨ç­›é€‰åçš„è§’è‰²æ•°æ®
        let isFiltering = false; // æ˜¯å¦æ­£åœ¨ç­›é€‰çŠ¶æ€

        // åˆå§‹åŒ–å’Œæ•°æ®ç®¡ç†
        function init() {
            loadSystemData();
            updateDemoAccounts();
            document.getElementById('currentDate').textContent = currentDate;
        }

        function loadSystemData() {
            const savedData = localStorage.getItem('nw_system_data');
            if (savedData) {
                try {
                    systemData = { ...systemData, ...JSON.parse(savedData) };
                    if (systemData.systemTitle) {
                        document.querySelector('.login-title').textContent = systemData.systemTitle;
                    }
                } catch (e) {
                    console.log('åŠ è½½ç³»ç»Ÿæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®');
                }
            }
        }

        function saveSystemData() {
            localStorage.setItem('nw_system_data', JSON.stringify(systemData));
        }

        function updateDemoAccounts() {
            const container = document.getElementById('demoAccounts');
            container.innerHTML = '';
            
            // åªæ˜¾ç¤ºå‘˜å·¥è´¦å·çš„å¿«é€Ÿç™»å½•
            const employees = Object.keys(systemData.users).filter(username => 
                systemData.users[username].role === 'employee'
            );
            
            if (employees.length === 0) {
                // å¦‚æœæ²¡æœ‰å‘˜å·¥è´¦å·ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                const tipDiv = document.createElement('div');
                tipDiv.className = 'demo-account';
                tipDiv.innerHTML = `
                    <div class="account-info">
                        <div style="color: #ccc;">æš‚æ— å‘˜å·¥è´¦å·</div>
                        <div class="account-role">è¯·è”ç³»ç®¡ç†å‘˜åˆ›å»ºè´¦å·</div>
                    </div>
                `;
                container.appendChild(tipDiv);
            } else {
                // æ˜¾ç¤ºå‘˜å·¥è´¦å·
                employees.forEach(username => {
                    const user = systemData.users[username];
                    const userDiv = document.createElement('div');
                    userDiv.className = 'demo-account';
                    userDiv.innerHTML = `
                        <div class="account-info">
                            <div><strong>${username}</strong></div>
                            <div class="account-role">å‘˜å·¥ - ${user.department} ${user.name}</div>
                        </div>
                        <button class="quick-login" onclick="quickLogin('${username}', '123456')">å¿«é€Ÿç™»å½•</button>
                    `;
                    container.appendChild(userDiv);
                });
            }
        }

        // ç¼–è¾‘åŠŸèƒ½
        function editSystemTitle() {
            const titleElement = document.querySelector('.login-title');
            const currentTitle = titleElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'title-edit-input';
            input.value = currentTitle;
            input.style.fontSize = '2em';
            
            titleElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newTitle = input.value.trim() || currentTitle;
                systemData.systemTitle = newTitle;
                
                const newTitleElement = document.createElement('h1');
                newTitleElement.className = 'login-title';
                newTitleElement.textContent = newTitle;
                newTitleElement.ondblclick = editSystemTitle;
                
                input.replaceWith(newTitleElement);
                saveSystemData();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        function editWelcomeText() {
            const welcomeElement = document.getElementById('welcomeText');
            const currentText = welcomeElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'title-edit-input';
            input.value = currentText;
            
            welcomeElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newText = input.value.trim() || currentText;
                welcomeMessage = newText;
                
                const newWelcomeElement = document.createElement('div');
                newWelcomeElement.className = 'welcome-text';
                newWelcomeElement.id = 'welcomeText';
                newWelcomeElement.ondblclick = editWelcomeText;
                newWelcomeElement.innerHTML = newText;
                
                input.replaceWith(newWelcomeElement);
                saveUserPreferences();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        function editPanelTitle() {
            const titleElement = document.getElementById('employeePanelTitle');
            const currentTitle = titleElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'title-edit-input';
            input.value = currentTitle;
            input.style.fontSize = '1.8em';
            
            titleElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newTitle = input.value.trim() || currentTitle;
                panelTitle = newTitle;
                
                const newTitleElement = document.createElement('div');
                newTitleElement.className = 'panel-title';
                newTitleElement.id = 'employeePanelTitle';
                newTitleElement.textContent = newTitle;
                newTitleElement.ondblclick = editPanelTitle;
                
                input.replaceWith(newTitleElement);
                saveUserPreferences();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        // ç™»å½•ç›¸å…³å‡½æ•°
        function quickLogin(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
            handleLogin({ preventDefault: () => {} });
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (systemData.users[username] && systemData.users[username].password === password) {
                currentUser = systemData.users[username];
                currentUser.username = username;
                showMainInterface();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }

        function logout() {
            if (currentUser && currentUser.role === 'employee') {
                saveUserProgress();
            }
            currentUser = null;
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showMainInterface() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = `${currentUser.department} - ${currentUser.role === 'admin' ? 'ç®¡ç†å‘˜' : 'å‘˜å·¥'}`;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);

            if (currentUser.role === 'admin') {
                showAdminPanel();
            } else {
                showEmployeePanel();
            }
        }

        // å‘˜å·¥é¢æ¿åŠŸèƒ½
        function showEmployeePanel() {
            document.getElementById('employeePanel').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            
            loadUserPreferences();
            initEmployeeGameData();
            loadEmployeeProgress();
            updateBatchServerSelect();
            initSearchFilters();
            renderWindows();
            updateAllProgress();
            updateEmployeeStats();
        }

        function loadUserPreferences() {
            const savedPrefs = localStorage.getItem(`user_prefs_${currentUser.username}`);
            if (savedPrefs) {
                try {
                    const prefs = JSON.parse(savedPrefs);
                    if (prefs.panelTitle) {
                        panelTitle = prefs.panelTitle;
                        document.getElementById('employeePanelTitle').textContent = panelTitle;
                    }
                    if (prefs.welcomeMessage) {
                        welcomeMessage = prefs.welcomeMessage;
                        document.getElementById('welcomeText').innerHTML = welcomeMessage;
                    }
                } catch (e) {
                    console.log('åŠ è½½ç”¨æˆ·åå¥½å¤±è´¥');
                }
            }
        }

        function saveUserPreferences() {
            const prefs = {
                panelTitle: panelTitle,
                welcomeMessage: welcomeMessage
            };
            localStorage.setItem(`user_prefs_${currentUser.username}`, JSON.stringify(prefs));
        }

        function initEmployeeGameData() {
            if (!currentUser.taskConfig) {
                currentUser.taskConfig = {
                    windows: 3,
                    zonesPerWindow: 2,
                    charactersPerZone: 4
                };
            }
            
            const config = currentUser.taskConfig;
            gameData = {};
            windowOrder = [];
            
            for (let windowId = 1; windowId <= config.windows; windowId++) {
                windowOrder.push(windowId);
                gameData[windowId] = {
                    name: `${windowId}ç»„æœº`,
                    zones: {}
                };
                
                for (let zoneId = 1; zoneId <= config.zonesPerWindow; zoneId++) {
                    gameData[windowId].zones[zoneId] = {
                        name: `${zoneId}å·æœº`,
                        characters: []
                    };
                    
                    for (let charId = 1; charId <= config.charactersPerZone; charId++) {
                        gameData[windowId].zones[zoneId].characters.push({
                            name: `è§’è‰²${charId}`,
                            server: systemData.serverList[Math.floor(Math.random() * systemData.serverList.length)]
                        });
                    }
                }
            }
            
            // åŠ è½½å·²ä¿å­˜çš„æ¸¸æˆæ•°æ®
            const savedGameData = localStorage.getItem(`gameData_${currentUser.username}`);
            if (savedGameData) {
                try {
                    const loaded = JSON.parse(savedGameData);
                    // åˆå¹¶åŠ è½½çš„æ•°æ®å’Œé»˜è®¤æ•°æ®
                    Object.keys(loaded.gameData || {}).forEach(windowId => {
                        if (gameData[windowId]) {
                            Object.assign(gameData[windowId], loaded.gameData[windowId]);
                        }
                    });
                    if (loaded.windowOrder) {
                        windowOrder = loaded.windowOrder;
                    }
                } catch (e) {
                    console.log('åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥');
                }
            }
        }

        function loadEmployeeProgress() {
            const todayKey = currentDate;
            if (!currentUser.dailyRecords) {
                currentUser.dailyRecords = {};
            }
            progress = currentUser.dailyRecords[todayKey] || {};
        }

        function saveUserProgress() {
            const todayKey = currentDate;
            if (!currentUser.dailyRecords) {
                currentUser.dailyRecords = {};
            }
            currentUser.dailyRecords[todayKey] = { ...progress };
            
            // ä¿å­˜æ¸¸æˆæ•°æ®
            const userData = {
                gameData: gameData,
                windowOrder: windowOrder,
                progress: progress,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem(`gameData_${currentUser.username}`, JSON.stringify(userData));
            
            // ä¿å­˜åˆ°ç³»ç»Ÿæ•°æ®
            saveSystemData();
        }

        function updateEmployeeStats() {
            const totalCompleted = Object.values(progress).filter(Boolean).length;
            const totalCharacters = getTotalCharacters();
            const todayPercentage = totalCharacters > 0 ? Math.round((totalCompleted / totalCharacters) * 100) : 0;
            
            document.getElementById('todayProgress').textContent = `${todayPercentage}%`;
            document.getElementById('monthProgress').textContent = `${currentUser.monthlyStats?.completionRate || 0}%`;
            document.getElementById('streakDays').textContent = currentUser.monthlyStats?.streakDays || 0;
            document.getElementById('monthRank').textContent = `#${currentUser.monthlyStats?.rank || 1}`;
        }

        function submitProgress() {
            saveUserProgress();
            
            const totalCompleted = Object.values(progress).filter(Boolean).length;
            const totalCharacters = getTotalCharacters();
            const completionRate = totalCharacters > 0 ? Math.round((totalCompleted / totalCharacters) * 100) : 0;
            
            // æ›´æ–°æœˆåº¦ç»Ÿè®¡
            if (!currentUser.monthlyStats) {
                currentUser.monthlyStats = {
                    completionRate: 0,
                    rank: 1,
                    streakDays: 0
                };
            }
            
            // ç®€å•çš„ç»Ÿè®¡æ›´æ–°é€»è¾‘
            if (completionRate === 100) {
                currentUser.monthlyStats.streakDays += 1;
            }
            
            saveSystemData();
            
            alert(`âœ… è¿›åº¦æäº¤æˆåŠŸï¼\n\nä»Šæ—¥å®Œæˆç‡ï¼š${completionRate}%\nå®Œæˆä»»åŠ¡ï¼š${totalCompleted}/${totalCharacters}\n\nç®¡ç†å‘˜å°†æ ¹æ®æ­¤è®°å½•è®¡ç®—æ‚¨çš„ç»©æ•ˆå¥–é‡‘ã€‚`);
        }

        // [ç»§ç»­åŒ…å«åŸæœ‰çš„æ‰€æœ‰å‘˜å·¥ç«¯åŠŸèƒ½å‡½æ•°...]
        // è¿™é‡ŒåŒ…å«æ‰€æœ‰åŸæ¥çš„å‘˜å·¥ç«¯åŠŸèƒ½ï¼šçª—å£ç®¡ç†ã€åŒºåŸŸç®¡ç†ã€è§’è‰²ç®¡ç†ã€æœåŠ¡å™¨ç®¡ç†ç­‰

        // æœåŠ¡å™¨ç®¡ç†ç›¸å…³å‡½æ•°
        function updateBatchServerSelect() {
            const select = document.getElementById('batchServerSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è¦æ‰¹é‡åº”ç”¨çš„æœåŠ¡å™¨</option>';
            
            systemData.serverList.forEach(server => {
                const option = document.createElement('option');
                option.value = server;
                option.textContent = server;
                select.appendChild(option);
            });
        }

        function applyBatchServer() {
            const selectedServer = document.getElementById('batchServerSelect').value;
            if (!selectedServer) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨ï¼');
                return;
            }

            if (confirm(`ç¡®å®šè¦å°†æ‰€æœ‰ç»„æœºçš„æœåŠ¡å™¨éƒ½è®¾ç½®ä¸º "${selectedServer}" å—ï¼Ÿ`)) {
                Object.keys(gameData).forEach(windowId => {
                    Object.keys(gameData[windowId].zones).forEach(zoneId => {
                        gameData[windowId].zones[zoneId].characters.forEach(char => {
                            char.server = selectedServer;
                        });
                    });
                });
                
                saveUserProgress();
                renderWindows();
                updateAllProgress();
                alert('æ‰¹é‡è®¾ç½®å®Œæˆï¼');
            }
        }

        function toggleServerManagement() {
            const content = document.getElementById('serverManagementContent');
            const collapsible = document.querySelector('.collapsible');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                collapsible.classList.remove('active');
            } else {
                content.classList.add('show');
                collapsible.classList.add('active');
                updateServerManagementUI();
            }
        }

        function updateServerManagementUI() {
            updateServerListForDeletion();
            updateCurrentServerList();
        }

        function updateServerListForDeletion() {
            const container = document.getElementById('serverListForDeletion');
            container.innerHTML = '';
            
            systemData.serverList.forEach((server, index) => {
                const serverItem = document.createElement('div');
                serverItem.className = 'server-item';
                serverItem.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" class="server-checkbox" id="server-${index}" value="${server}"
                               onchange="toggleServerSelection(this)">
                        <span>${server}</span>
                    </div>
                `;
                container.appendChild(serverItem);
            });
        }

        function toggleServerSelection(checkbox) {
            const serverItem = checkbox.closest('.server-item');
            if (checkbox.checked) {
                serverItem.classList.add('selected');
            } else {
                serverItem.classList.remove('selected');
            }
        }

        function updateCurrentServerList() {
            const container = document.getElementById('currentServerList');
            container.innerHTML = '';
            
            if (systemData.serverList.length === 0) {
                container.innerHTML = '<div style="color: #ccc; text-align: center;">æš‚æ— æœåŠ¡å™¨</div>';
                return;
            }
            
            systemData.serverList.forEach((server, index) => {
                const serverItem = document.createElement('div');
                serverItem.className = 'server-item';
                serverItem.innerHTML = `
                    <span>${index + 1}. ${server}</span>
                `;
                container.appendChild(serverItem);
            });
        }

        function batchAddServers() {
            const textarea = document.getElementById('batchAddServers');
            const newServers = textarea.value.split('\n')
                .map(s => s.trim())
                .filter(s => s.length > 0 && !systemData.serverList.includes(s));
            
            if (newServers.length === 0) {
                alert('æ²¡æœ‰æ‰¾åˆ°æ–°çš„æœåŠ¡å™¨åç§°ï¼Œæˆ–è€…è¾“å…¥çš„æœåŠ¡å™¨å·²ç»å­˜åœ¨ï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ·»åŠ  ${newServers.length} ä¸ªæ–°æœåŠ¡å™¨å—ï¼Ÿ\n\n${newServers.join('\n')}`)) {
                systemData.serverList = systemData.serverList.concat(newServers);
                saveSystemData();
                updateBatchServerSelect();
                updateServerManagementUI();
                renderWindows();
                textarea.value = '';
                alert(`æˆåŠŸæ·»åŠ  ${newServers.length} ä¸ªæœåŠ¡å™¨ï¼`);
            }
        }

        function selectAllServers() {
            document.querySelectorAll('.server-checkbox').forEach(checkbox => {
                checkbox.checked = true;
                checkbox.closest('.server-item').classList.add('selected');
            });
        }

        function deselectAllServers() {
            document.querySelectorAll('.server-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.server-item').classList.remove('selected');
            });
        }

        function batchDeleteServers() {
            const selectedServers = [];
            document.querySelectorAll('.server-checkbox:checked').forEach(checkbox => {
                selectedServers.push(checkbox.value);
            });
            
            if (selectedServers.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æœåŠ¡å™¨ï¼');
                return;
            }
            
            if (selectedServers.length === systemData.serverList.length) {
                alert('ä¸èƒ½åˆ é™¤æ‰€æœ‰æœåŠ¡å™¨ï¼Œè‡³å°‘è¦ä¿ç•™ä¸€ä¸ªï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${selectedServers.length} ä¸ªæœåŠ¡å™¨å—ï¼Ÿ\n\n${selectedServers.join('\n')}\n\nåˆ é™¤åï¼Œä½¿ç”¨è¿™äº›æœåŠ¡å™¨çš„è§’è‰²å°†è‡ªåŠ¨åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨æœåŠ¡å™¨ã€‚`)) {
                const remainingServers = systemData.serverList.filter(s => !selectedServers.includes(s));
                const fallbackServer = remainingServers[0];
                
                Object.keys(gameData).forEach(windowId => {
                    Object.keys(gameData[windowId].zones).forEach(zoneId => {
                        gameData[windowId].zones[zoneId].characters.forEach(char => {
                            if (selectedServers.includes(char.server)) {
                                char.server = fallbackServer;
                            }
                        });
                    });
                });
                
                systemData.serverList = remainingServers;
                saveSystemData();
                updateBatchServerSelect();
                updateServerManagementUI();
                renderWindows();
                alert(`æˆåŠŸåˆ é™¤ ${selectedServers.length} ä¸ªæœåŠ¡å™¨ï¼`);
            }
        }

        function loadDefaultServers() {
            if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤æœåŠ¡å™¨åˆ—è¡¨å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨å¹¶æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚')) {
                systemData.serverList = [
                    'APâ€”â€”Delos æ¾³æ´²æœ',
                    'US Westâ€”â€”Eldorado ç¾è¥¿æœ', 
                    'US Eastâ€”â€”Valhalla ç¾ä¸œæœ',
                    'EU Centralâ€”â€”Aries æ¬§æ´²æœ'
                ];
                
                Object.keys(gameData).forEach(windowId => {
                    Object.keys(gameData[windowId].zones).forEach(zoneId => {
                        gameData[windowId].zones[zoneId].characters.forEach(char => {
                            if (!systemData.serverList.includes(char.server)) {
                                char.server = systemData.serverList[0];
                            }
                        });
                    });
                });
                
                saveSystemData();
                updateBatchServerSelect();
                updateServerManagementUI();
                renderWindows();
                alert('é»˜è®¤æœåŠ¡å™¨åˆ—è¡¨æ¢å¤æˆåŠŸï¼');
            }
        }

        // [è¿™é‡Œç»§ç»­åŒ…å«æ‰€æœ‰åŸæœ‰çš„çª—å£ç®¡ç†ã€è§’è‰²ç®¡ç†ç­‰å‡½æ•°...]
        // ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€éƒ¨åˆ†ç»§ç»­æ·»åŠ å…¶ä½™åŠŸèƒ½

        // ç®¡ç†å‘˜é¢æ¿åŠŸèƒ½
        function showAdminPanel() {
            document.getElementById('employeePanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            
            renderAdminStats();
            renderEmployeeTable();
        }

        function renderAdminStats() {
            const employees = Object.keys(systemData.users).filter(key => systemData.users[key].role === 'employee');
            let totalCompletionRate = 0;
            let onlineCount = 0;
            let totalTasks = 0;
            let bestEmployee = '';
            let bestRate = 0;

            employees.forEach(username => {
                const user = systemData.users[username];
                if (!user.taskConfig) return;
                
                const config = user.taskConfig;
                const userTotalTasks = config.windows * config.zonesPerWindow * config.charactersPerZone;
                totalTasks += userTotalTasks;
                
                const todayRecord = user.dailyRecords?.[currentDate] || {};
                const completedTasks = Object.values(todayRecord).filter(Boolean).length;
                const userCompletionRate = userTotalTasks > 0 ? Math.round((completedTasks / userTotalTasks) * 100) : 0;
                
                totalCompletionRate += userCompletionRate;
                if (Object.keys(todayRecord).length > 0) onlineCount++;
                
                if (userCompletionRate > bestRate) {
                    bestRate = userCompletionRate;
                    bestEmployee = user.name;
                }
            });

            const avgCompletionRate = employees.length > 0 ? Math.round(totalCompletionRate / employees.length) : 0;

            document.getElementById('adminTodayProgress').textContent = `${avgCompletionRate}%`;
            document.getElementById('onlineEmployees').textContent = onlineCount;
            document.getElementById('bestEmployee').textContent = bestEmployee || 'æš‚æ— ';
            document.getElementById('totalTasks').textContent = totalTasks;
        }

        function renderEmployeeTable() {
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';

            const employees = Object.keys(systemData.users).filter(key => systemData.users[key].role === 'employee');
            
            employees.forEach(username => {
                const user = systemData.users[username];
                if (!user.taskConfig) {
                    user.taskConfig = { windows: 1, zonesPerWindow: 1, charactersPerZone: 1 };
                }
                
                const config = user.taskConfig;
                const userTotalTasks = config.windows * config.zonesPerWindow * config.charactersPerZone;
                
                const todayRecord = user.dailyRecords?.[currentDate] || {};
                const completedTasks = Object.values(todayRecord).filter(Boolean).length;
                const todayCompletionRate = userTotalTasks > 0 ? Math.round((completedTasks / userTotalTasks) * 100) : 0;
                
                const lastSubmit = Object.keys(todayRecord).length > 0 ? 'ä»Šå¤©' : 'æœªæäº¤';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${user.name}</strong></td>
                    <td>${username}</td>
                    <td>${user.department}</td>
                    <td>${config.windows}ç»„æœº Ã— ${config.zonesPerWindow}å·æœº Ã— ${config.charactersPerZone}è§’è‰²</td>
                    <td>
                        <div class="performance-bar">
                            <div class="performance-fill" style="width: ${todayCompletionRate}%"></div>
                            <div class="performance-text">${completedTasks}/${userTotalTasks} (${todayCompletionRate}%)</div>
                        </div>
                    </td>
                    <td><strong>${user.monthlyStats?.completionRate || 0}%</strong></td>
                    <td>${lastSubmit}</td>
                    <td>
                        <button class="btn btn-primary btn-small" onclick="editUser('${username}')">ç¼–è¾‘</button>
                        <button class="btn btn-secondary btn-small" onclick="viewUserDetail('${username}')">è¯¦æƒ…</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        function createUser() {
            const username = document.getElementById('newUsername').value.trim();
            const name = document.getElementById('newName').value.trim();
            const department = document.getElementById('newDepartment').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const windows = parseInt(document.getElementById('newWindows').value) || 3;
            const zones = parseInt(document.getElementById('newZones').value) || 2;
            const characters = parseInt(document.getElementById('newCharacters').value) || 5;

            if (!username || !name || !department || !password) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }

            if (systemData.users[username]) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·åï¼');
                return;
            }

            systemData.users[username] = {
                name: name,
                role: 'employee',
                password: password,
                department: department,
                taskConfig: {
                    windows: windows,
                    zonesPerWindow: zones,
                    charactersPerZone: characters
                },
                dailyRecords: {},
                monthlyStats: {
                    completionRate: 0,
                    rank: Object.keys(systemData.users).filter(k => systemData.users[k].role === 'employee').length + 1,
                    streakDays: 0
                }
            };

            saveSystemData();
            updateDemoAccounts();
            renderAdminStats();
            renderEmployeeTable();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('newUsername').value = '';
            document.getElementById('newName').value = '';
            document.getElementById('newDepartment').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newWindows').value = '3';
            document.getElementById('newZones').value = '2';
            document.getElementById('newCharacters').value = '5';

            alert(`ç”¨æˆ· "${name}" åˆ›å»ºæˆåŠŸï¼\nç”¨æˆ·åï¼š${username}\nä»»åŠ¡é…ç½®ï¼š${windows}ç»„æœº Ã— ${zones}å·æœº Ã— ${characters}è§’è‰²`);
        }

        function editUser(username) {
            const user = systemData.users[username];
            if (!user) return;

            // å¡«å……æ¨¡æ€æ¡†æ•°æ®
            document.getElementById('modalUsername').value = username;
            document.getElementById('modalName').value = user.name;
            document.getElementById('modalDepartment').value = user.department;
            document.getElementById('modalWindows').value = user.taskConfig?.windows || 3;
            document.getElementById('modalZones').value = user.taskConfig?.zonesPerWindow || 2;
            document.getElementById('modalCharacters').value = user.taskConfig?.charactersPerZone || 5;

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('userModal').style.display = 'block';
        }

        function saveUserConfig() {
            const username = document.getElementById('modalUsername').value;
            const user = systemData.users[username];
            if (!user) return;

            user.name = document.getElementById('modalName').value.trim();
            user.department = document.getElementById('modalDepartment').value.trim();
            
            if (!user.taskConfig) user.taskConfig = {};
            user.taskConfig.windows = parseInt(document.getElementById('modalWindows').value) || 3;
            user.taskConfig.zonesPerWindow = parseInt(document.getElementById('modalZones').value) || 2;
            user.taskConfig.charactersPerZone = parseInt(document.getElementById('modalCharacters').value) || 5;

            saveSystemData();
            updateDemoAccounts();
            renderAdminStats();
            renderEmployeeTable();
            closeUserModal();
            
            alert('ç”¨æˆ·é…ç½®ä¿å­˜æˆåŠŸï¼');
        }

        function deleteUser() {
            const username = document.getElementById('modalUsername').value;
            if (username === 'admin') {
                alert('ä¸èƒ½åˆ é™¤ç®¡ç†å‘˜è´¦å·ï¼');
                return;
            }

            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${systemData.users[username]?.name}" å—ï¼Ÿ\n\nåˆ é™¤åå°†æ— æ³•æ¢å¤ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®ï¼`)) {
                delete systemData.users[username];
                // åˆ é™¤ç”¨æˆ·ç›¸å…³çš„æœ¬åœ°æ•°æ®
                localStorage.removeItem(`gameData_${username}`);
                localStorage.removeItem(`user_prefs_${username}`);
                
                saveSystemData();
                updateDemoAccounts();
                renderAdminStats();
                renderEmployeeTable();
                closeUserModal();
                
                alert('ç”¨æˆ·åˆ é™¤æˆåŠŸï¼');
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        function viewUserDetail(username) {
            const user = systemData.users[username];
            if (!user.taskConfig) return;
            
            const config = user.taskConfig;
            const userTotalTasks = config.windows * config.zonesPerWindow * config.charactersPerZone;
            const todayRecord = user.dailyRecords?.[currentDate] || {};
            const completedTasks = Object.values(todayRecord).filter(Boolean).length;
            const todayRate = Math.round((completedTasks / userTotalTasks) * 100);
            
            alert(`å‘˜å·¥è¯¦æƒ…ï¼š${user.name}\n\n` +
                  `ç”¨æˆ·åï¼š${username}\n` +
                  `éƒ¨é—¨ï¼š${user.department}\n` +
                  `ä»»åŠ¡é…ç½®ï¼š${config.windows}ç»„æœº Ã— ${config.zonesPerWindow}å·æœº Ã— ${config.charactersPerZone}è§’è‰²\n` +
                  `ä»Šæ—¥è¿›åº¦ï¼š${completedTasks}/${userTotalTasks} (${todayRate}%)\n` +
                  `æœ¬æœˆå®Œæˆç‡ï¼š${user.monthlyStats?.completionRate || 0}%\n` +
                  `è¿ç»­å®Œæˆï¼š${user.monthlyStats?.streakDays || 0}å¤©\n` +
                  `éƒ¨é—¨æ’åï¼šç¬¬${user.monthlyStats?.rank || 1}å`);
        }

        // ç®¡ç†å‘˜æ“ä½œå‡½æ•°
        function exportReport() {
            let report = `${systemData.systemTitle} - å‘˜å·¥ç»©æ•ˆæŠ¥è¡¨\n`;
            report += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}\n`;
            report += `===========================================\n\n`;
            
            const employees = Object.keys(systemData.users).filter(key => systemData.users[key].role === 'employee');
            
            employees.forEach(username => {
                const user = systemData.users[username];
                const config = user.taskConfig || { windows: 0, zonesPerWindow: 0, charactersPerZone: 0 };
                const userTotalTasks = config.windows * config.zonesPerWindow * config.charactersPerZone;
                const todayRecord = user.dailyRecords?.[currentDate] || {};
                const completedTasks = Object.values(todayRecord).filter(Boolean).length;
                const todayRate = userTotalTasks > 0 ? Math.round((completedTasks / userTotalTasks) * 100) : 0;
                
                report += `å‘˜å·¥ï¼š${user.name} (${username})\n`;
                report += `éƒ¨é—¨ï¼š${user.department}\n`;
                report += `ä»»åŠ¡é…ç½®ï¼š${config.windows}ç»„æœº Ã— ${config.zonesPerWindow}å·æœº Ã— ${config.charactersPerZone}è§’è‰²\n`;
                report += `ä»Šæ—¥å®Œæˆç‡ï¼š${todayRate}% (${completedTasks}/${userTotalTasks})\n`;
                report += `æœ¬æœˆå®Œæˆç‡ï¼š${user.monthlyStats?.completionRate || 0}%\n`;
                report += `è¿ç»­å¤©æ•°ï¼š${user.monthlyStats?.streakDays || 0}å¤©\n\n`;
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å‘˜å·¥ç»©æ•ˆæŠ¥è¡¨_${currentDate.replace(/\//g, '-')}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('ğŸ“ˆ æŠ¥è¡¨å·²ç”Ÿæˆå¹¶ä¸‹è½½ï¼');
        }

        function resetAllEmployeeProgress() {
            if (confirm('âš ï¸ ç¡®å®šè¦é‡ç½®æ‰€æœ‰å‘˜å·¥çš„ä»Šæ—¥è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                Object.keys(systemData.users).forEach(username => {
                    if (systemData.users[username].role === 'employee') {
                        if (!systemData.users[username].dailyRecords) {
                            systemData.users[username].dailyRecords = {};
                        }
                        systemData.users[username].dailyRecords[currentDate] = {};
                        // æ¸…ç†æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·æ•°æ®
                        localStorage.removeItem(`gameData_${username}`);
                    }
                });
                saveSystemData();
                renderAdminStats();
                renderEmployeeTable();
                alert('âœ… æ‰€æœ‰å‘˜å·¥çš„ä»Šæ—¥è¿›åº¦å·²é‡ç½®ï¼');
            }
        }

        function backupData() {
            const backupData = {
                systemData: systemData,
                backupTime: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç³»ç»Ÿæ•°æ®å¤‡ä»½_${currentDate.replace(/\//g, '-')}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('ğŸ’¾ ç³»ç»Ÿæ•°æ®å¤‡ä»½æˆåŠŸï¼');
        }

        function calculatePerformance() {
            let performanceReport = 'ğŸ’° ç»©æ•ˆè®¡ç®—æŠ¥å‘Š\n\n';
            let totalBonus = 0;
            
            const employees = Object.keys(systemData.users).filter(key => systemData.users[key].role === 'employee');
            const baseBonus = 100; // åŸºç¡€å¥–é‡‘
            
            employees.forEach(username => {
                const user = systemData.users[username];
                const monthlyRate = user.monthlyStats?.completionRate || 0;
                const streakBonus = (user.monthlyStats?.streakDays || 0) * 10;
                const performanceBonus = Math.round(baseBonus * (monthlyRate / 100) + streakBonus);
                
                totalBonus += performanceBonus;
                performanceReport += `${user.name}ï¼šÂ¥${performanceBonus}\n`;
                performanceReport += `  åŸºç¡€å¥–é‡‘ï¼šÂ¥${baseBonus}\n`;
                performanceReport += `  å®Œæˆç‡å¥–é‡‘ï¼šÂ¥${Math.round(baseBonus * (monthlyRate / 100))}\n`;
                performanceReport += `  è¿ç»­å¥–é‡‘ï¼šÂ¥${streakBonus}\n\n`;
            });
            
            performanceReport += `æ€»è®¡å¥–é‡‘ï¼šÂ¥${totalBonus}`;
            alert(performanceReport);
        }

        // [ç»§ç»­æ·»åŠ æ‰€æœ‰å‘˜å·¥ç«¯çš„åŠŸèƒ½å‡½æ•°...]
        // ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæˆ‘å°†åœ¨æ¥ä¸‹æ¥æ·»åŠ å…¶ä½™å¿…è¦çš„åŠŸèƒ½

        // çª—å£å’Œä»»åŠ¡ç®¡ç†çš„æ ¸å¿ƒå‡½æ•°
        function renderWindows() {
            const container = document.getElementById('windowsContainer');
            container.innerHTML = '';

            windowOrder.forEach(windowId => {
                if (!gameData[windowId]) return;

                const windowDiv = document.createElement('div');
                windowDiv.className = 'window-card';
                windowDiv.draggable = true;
                windowDiv.dataset.windowId = windowId;
                
                // æ‹–æ‹½äº‹ä»¶
                windowDiv.addEventListener('dragstart', handleDragStart);
                windowDiv.addEventListener('dragover', handleDragOver);
                windowDiv.addEventListener('drop', handleDrop);
                windowDiv.addEventListener('dragend', handleDragEnd);

                const windowData = gameData[windowId];
                const windowCompleted = getWindowProgress(windowId);
                const windowTotal = getTotalCharactersInWindow(windowId);
                
                let zonesTabsHtml = '';
                let zonesContentHtml = '';
                
                Object.keys(windowData.zones).forEach((zoneId, index) => {
                    const zone = windowData.zones[zoneId];
                    const zoneProgress = getZoneProgress(windowId, zoneId);
                    const zoneTotal = zone.characters.length;
                    
                    zonesTabsHtml += `
                        <div class="zone-tab ${index === 0 ? 'active' : ''}" onclick="switchZone(${windowId}, '${zoneId}')">
                            <span class="zone-tab-content" ondblclick="editZoneName(${windowId}, '${zoneId}')" 
                                  id="zone-name-${windowId}-${zoneId}">${zone.name}</span>
                            <span class="zone-progress">(${zoneProgress}/${zoneTotal})</span>
                            <button class="zone-delete-btn" onclick="deleteZone(${windowId}, '${zoneId}')" 
                                    title="åˆ é™¤å·æœº">Ã—</button>
                        </div>
                    `;

                    const charactersHtml = zone.characters.map((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        const isCompleted = progress[charKey] || false;
                        
                        return `
                            <div class="character-card ${isCompleted ? 'completed' : ''}">
                                <div class="character-header">
                                    <input type="checkbox" class="character-checkbox" id="${charKey}" 
                                           ${isCompleted ? 'checked' : ''} onchange="toggleCharacter('${charKey}')">
                                    <button class="character-delete" onclick="deleteCharacter(${windowId}, '${zoneId}', ${charIndex})" 
                                            title="åˆ é™¤è§’è‰²">Ã—</button>
                                </div>
                                <div class="character-server">${char.server}</div>
                                <div class="character-name" ondblclick="editCharacterName(${windowId}, '${zoneId}', ${charIndex})" 
                                     id="char-name-${windowId}-${zoneId}-${charIndex}">${char.name}</div>
                            </div>
                        `;
                    }).join('');

                    zonesContentHtml += `
                        <div class="zone-content ${index === 0 ? 'active' : ''}" id="zone-${windowId}-${zoneId}">
                            <div class="zone-controls">
                                <div class="zone-progress-info">${zone.name}: ${zoneProgress}/${zoneTotal}</div>
                                <div>
                                    <button class="btn btn-small btn-primary" onclick="selectZone(${windowId}, '${zoneId}')">å…¨é€‰</button>
                                    <button class="btn btn-small btn-secondary" onclick="clearZone(${windowId}, '${zoneId}')">æ¸…ç©º</button>
                                </div>
                            </div>
                            
                            <div class="server-select-container">
                                <span class="server-select-label">æœåŠ¡å™¨:</span>
                                <div class="custom-select">
                                    <div class="select-display" onclick="toggleServerSelect(${windowId}, '${zoneId}')">
                                        <span id="selected-server-${windowId}-${zoneId}">${zone.characters[0]?.server || systemData.serverList[0]}</span>
                                        <div class="select-arrow"></div>
                                    </div>
                                    <div class="select-options" id="server-options-${windowId}-${zoneId}">
                                        <input type="text" class="add-server-input" placeholder="è¾“å…¥æ–°æœåŠ¡å™¨åç§°åæŒ‰å›è½¦" 
                                               onkeypress="addServerOnEnter(event, ${windowId}, '${zoneId}')">
                                        ${systemData.serverList.map(server => `
                                            <div class="select-option ${server === (zone.characters[0]?.server || systemData.serverList[0]) ? 'selected' : ''}" 
                                                 onclick="selectServer(${windowId}, '${zoneId}', '${server}')">
                                                <span>${server}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="characters-grid">
                                ${charactersHtml}
                                <div class="add-character-btn" onclick="addCharacter(${windowId}, '${zoneId}')">
                                    â• æ·»åŠ è§’è‰²
                                </div>
                            </div>
                        </div>
                    `;
                });

                windowDiv.innerHTML = `
                    <div class="window-header">
                        <div class="window-title" ondblclick="editWindowName(${windowId})" 
                             id="window-name-${windowId}">${windowData.name}</div>
                        <div class="window-progress">${windowCompleted}/${windowTotal}</div>
                        <div class="window-controls">
                            <button class="btn btn-small btn-success" onclick="addZone(${windowId})">+å·æœº</button>
                            <button class="btn btn-small btn-primary" onclick="selectWindow(${windowId})">å…¨é€‰</button>
                            <button class="btn btn-small btn-secondary" onclick="clearWindow(${windowId})">æ¸…ç©º</button>
                            <button class="btn btn-small btn-danger" onclick="deleteWindow(${windowId})" title="åˆ é™¤ç»„æœº">Ã—</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="zones-tabs" id="tabs-${windowId}">
                            ${zonesTabsHtml}
                            <button class="zone-add-btn" onclick="addZone(${windowId})">+ å·æœº</button>
                        </div>
                        <div id="zones-${windowId}">
                            ${zonesContentHtml}
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                `;
                
                container.appendChild(windowDiv);
            });
        }

        // æ·»åŠ æ‰€æœ‰å¿…è¦çš„å·¥å…·å‡½æ•°
        function getTotalCharacters() {
            let total = 0;
            Object.keys(gameData).forEach(windowId => {
                Object.keys(gameData[windowId].zones).forEach(zoneId => {
                    total += gameData[windowId].zones[zoneId].characters.length;
                });
            });
            return total;
        }

        function getWindowProgress(windowId) {
            let completed = 0;
            Object.keys(gameData[windowId].zones).forEach(zoneId => {
                gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                    const charKey = `${windowId}-${zoneId}-${charIndex}`;
                    if (progress[charKey]) completed++;
                });
            });
            return completed;
        }

        function getTotalCharactersInWindow(windowId) {
            let total = 0;
            Object.keys(gameData[windowId].zones).forEach(zoneId => {
                total += gameData[windowId].zones[zoneId].characters.length;
            });
            return total;
        }

        function getZoneProgress(windowId, zoneId) {
            let completed = 0;
            gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                const charKey = `${windowId}-${zoneId}-${charIndex}`;
                if (progress[charKey]) completed++;
            });
            return completed;
        }

        function updateAllProgress() {
            const totalCompleted = Object.values(progress).filter(Boolean).length;
            const totalCharacters = getTotalCharacters();
            const percentage = totalCharacters > 0 ? Math.round((totalCompleted / totalCharacters) * 100) : 0;
            const progressBar = document.getElementById('globalProgress');
            
            progressBar.textContent = `${totalCompleted}/${totalCharacters} (${percentage}%)`;
            progressBar.style.width = `${percentage}%`;
            
            if (percentage < 30) {
                progressBar.style.background = 'linear-gradient(90deg, #ff6b6b, #ee5a52)';
            } else if (percentage < 70) {
                progressBar.style.background = 'linear-gradient(90deg, #ffc107, #ff8f00)';
            } else {
                progressBar.style.background = 'linear-gradient(90deg, #4CAF50, #45a049)';
            }
            
            if (currentUser && currentUser.role === 'employee') {
                updateEmployeeStats();
            }
        }

        // ä»»åŠ¡æ“ä½œå‡½æ•°
        function selectAllTasks() {
            Object.keys(gameData).forEach(windowId => {
                Object.keys(gameData[windowId].zones).forEach(zoneId => {
                    gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        progress[charKey] = true;
                    });
                });
            });
            renderWindows();
            updateAllProgress();
        }

        function clearAllTasks() {
            progress = {};
            renderWindows();
            updateAllProgress();
        }

        function resetAllProgress() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä»Šæ—¥çš„æ‰€æœ‰è¿›åº¦å—ï¼Ÿ')) {
                progress = {};
                renderWindows();
                updateAllProgress();
            }
        }

        function toggleCharacter(charKey) {
            progress[charKey] = !progress[charKey];
            renderWindows();
            updateAllProgress();
        }

        // çª—å£æ“ä½œå‡½æ•°
        function addWindow() {
            const newId = Math.max(...Object.keys(gameData).map(Number), 0) + 1;
            windowOrder.push(newId);
            
            gameData[newId] = {
                name: `${newId}ç»„æœº`,
                zones: {
                    1: {
                        name: '1å·æœº',
                        characters: [{name: 'è§’è‰²1', server: systemData.serverList[0]}]
                    }
                }
            };
            
            renderWindows();
            updateAllProgress();
        }

        function deleteWindow(windowId) {
            if (Object.keys(gameData).length <= 1) {
                alert('è‡³å°‘è¦ä¿ç•™ä¸€ä¸ªç»„æœºï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${gameData[windowId].name} å—ï¼Ÿ`)) {
                delete gameData[windowId];
                windowOrder = windowOrder.filter(id => id !== windowId);
                
                Object.keys(progress).forEach(key => {
                    if (key.startsWith(`${windowId}-`)) {
                        delete progress[key];
                    }
                });
                
                renderWindows();
                updateAllProgress();
            }
        }

        function editWindowName(windowId) {
            const nameElement = document.getElementById(`window-name-${windowId}`);
            const currentName = nameElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'edit-input';
            input.value = currentName;
            
            nameElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newName = input.value.trim() || currentName;
                gameData[windowId].name = newName;
                renderWindows();
                updateAllProgress();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        // åŒºåŸŸæ“ä½œå‡½æ•°
        function addZone(windowId) {
            const zones = gameData[windowId].zones;
            const newZoneId = Math.max(...Object.keys(zones).map(Number)) + 1;
            
            zones[newZoneId] = {
                name: `${newZoneId}å·æœº`,
                characters: [{name: 'è§’è‰²1', server: systemData.serverList[0]}]
            };
            
            renderWindows();
            updateAllProgress();
        }

        function deleteZone(windowId, zoneId) {
            event.stopPropagation();
            
            if (Object.keys(gameData[windowId].zones).length <= 1) {
                alert('æ¯ä¸ªç»„æœºè‡³å°‘è¦ä¿ç•™ä¸€ä¸ªå·æœºï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${gameData[windowId].zones[zoneId].name} å—ï¼Ÿ`)) {
                delete gameData[windowId].zones[zoneId];
                
                Object.keys(progress).forEach(key => {
                    if (key.startsWith(`${windowId}-${zoneId}-`)) {
                        delete progress[key];
                    }
                });
                
                renderWindows();
                updateAllProgress();
            }
        }

        function editZoneName(windowId, zoneId) {
            event.stopPropagation();
            const nameElement = document.getElementById(`zone-name-${windowId}-${zoneId}`);
            const currentName = nameElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'edit-input';
            input.value = currentName;
            input.style.width = '80px';
            
            nameElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newName = input.value.trim() || currentName;
                gameData[windowId].zones[zoneId].name = newName;
                renderWindows();
                updateAllProgress();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        function switchZone(windowId, zoneId) {
            document.querySelectorAll(`#tabs-${windowId} .zone-tab`).forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`#tabs-${windowId} .zone-tab:nth-child(${Object.keys(gameData[windowId].zones).indexOf(zoneId) + 1})`).classList.add('active');

            document.querySelectorAll(`#zones-${windowId} .zone-content`).forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`zone-${windowId}-${zoneId}`).classList.add('active');
        }

        // è§’è‰²æ“ä½œå‡½æ•°
        function addCharacter(windowId, zoneId) {
            const characters = gameData[windowId].zones[zoneId].characters;
            const newCharIndex = characters.length + 1;
            
            characters.push({
                name: `è§’è‰²${newCharIndex}`,
                server: characters[0]?.server || systemData.serverList[0]
            });
            
            renderWindows();
            updateAllProgress();
        }

        function deleteCharacter(windowId, zoneId, charIndex) {
            const characters = gameData[windowId].zones[zoneId].characters;
            
            if (characters.length <= 1) {
                alert('æ¯ä¸ªå·æœºè‡³å°‘è¦ä¿ç•™ä¸€ä¸ªè§’è‰²ï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰² ${characters[charIndex].name} å—ï¼Ÿ`)) {
                characters.splice(charIndex, 1);
                
                const oldProgress = {...progress};
                Object.keys(oldProgress).forEach(key => {
                    if (key.startsWith(`${windowId}-${zoneId}-`)) {
                        delete progress[key];
                    }
                });
                
                characters.forEach((char, index) => {
                    const oldKeys = Object.keys(oldProgress).filter(k => k.startsWith(`${windowId}-${zoneId}-`));
                    const matchingKey = oldKeys[index];
                    if (matchingKey && oldProgress[matchingKey]) {
                        progress[`${windowId}-${zoneId}-${index}`] = oldProgress[matchingKey];
                    }
                });
                
                renderWindows();
                updateAllProgress();
            }
        }

        function editCharacterName(windowId, zoneId, charIndex) {
            const nameElement = document.getElementById(`char-name-${windowId}-${zoneId}-${charIndex}`);
            const currentName = nameElement.textContent;
            
            const input = document.createElement('input');
            input.className = 'edit-input';
            input.value = currentName;
            
            nameElement.replaceWith(input);
            input.focus();
            input.select();
            
            function saveEdit() {
                const newName = input.value.trim() || currentName;
                gameData[windowId].zones[zoneId].characters[charIndex].name = newName;
                renderWindows();
                updateAllProgress();
            }
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
            });
        }

        // æœåŠ¡å™¨é€‰æ‹©ç›¸å…³å‡½æ•°
        function toggleServerSelect(windowId, zoneId) {
            const selectElement = document.getElementById(`server-options-${windowId}-${zoneId}`);
            const displayElement = selectElement.previousElementSibling;
            
            selectElement.classList.toggle('show');
            displayElement.classList.toggle('open');
            
            document.querySelectorAll('.select-options').forEach(el => {
                if (el !== selectElement) {
                    el.classList.remove('show');
                }
            });
            document.querySelectorAll('.select-display').forEach(el => {
                if (el !== displayElement) {
                    el.classList.remove('open');
                }
            });
        }

        function selectServer(windowId, zoneId, serverName) {
            gameData[windowId].zones[zoneId].characters.forEach(char => {
                char.server = serverName;
            });
            
            renderWindows();
            updateAllProgress();
        }

        function addServerOnEnter(event, windowId, zoneId) {
            if (event.key === 'Enter') {
                const serverName = event.target.value.trim();
                if (serverName && !systemData.serverList.includes(serverName)) {
                    systemData.serverList.push(serverName);
                    saveSystemData();
                    updateBatchServerSelect();
                    selectServer(windowId, zoneId, serverName);
                }
                event.target.value = '';
            }
        }

        // é€‰æ‹©æ“ä½œå‡½æ•°
        function selectWindow(windowId) {
            Object.keys(gameData[windowId].zones).forEach(zoneId => {
                gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                    const charKey = `${windowId}-${zoneId}-${charIndex}`;
                    progress[charKey] = true;
                });
            });
            renderWindows();
            updateAllProgress();
        }

        function clearWindow(windowId) {
            Object.keys(gameData[windowId].zones).forEach(zoneId => {
                gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                    const charKey = `${windowId}-${zoneId}-${charIndex}`;
                    delete progress[charKey];
                });
            });
            renderWindows();
            updateAllProgress();
        }

        function selectZone(windowId, zoneId) {
            gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                const charKey = `${windowId}-${zoneId}-${charIndex}`;
                progress[charKey] = true;
            });
            renderWindows();
            updateAllProgress();
        }

        function clearZone(windowId, zoneId) {
            gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                const charKey = `${windowId}-${zoneId}-${charIndex}`;
                delete progress[charKey];
            });
            renderWindows();
            updateAllProgress();
        }

        // æ‹–æ‹½ç›¸å…³å‡½æ•°
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (this !== draggedElement) {
                const draggedId = parseInt(draggedElement.dataset.windowId);
                const targetId = parseInt(this.dataset.windowId);
                
                const draggedIndex = windowOrder.indexOf(draggedId);
                const targetIndex = windowOrder.indexOf(targetId);
                
                windowOrder.splice(draggedIndex, 1);
                windowOrder.splice(targetIndex, 0, draggedId);
                
                renderWindows();
                updateAllProgress();
            }
            
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.window-card').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.custom-select')) {
                document.querySelectorAll('.select-options').forEach(el => {
                    el.classList.remove('show');
                });
                document.querySelectorAll('.select-display').forEach(el => {
                    el.classList.remove('open');
                });
            }
        });

        // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('userModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // ==================== æ–°å¢åŠŸèƒ½ï¼šæœç´¢å’Œç­›é€‰ ====================
        
        function initSearchFilters() {
            const serverFilter = document.getElementById('serverFilter');
            serverFilter.innerHTML = '<option value="">æ‰€æœ‰æœåŠ¡å™¨</option>';
            
            systemData.serverList.forEach(server => {
                const option = document.createElement('option');
                option.value = server;
                option.textContent = server;
                serverFilter.appendChild(option);
            });
        }

        function filterCharacters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const serverFilter = document.getElementById('serverFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            isFiltering = true;
            filteredCharacters = [];
            
            Object.keys(gameData).forEach(windowId => {
                Object.keys(gameData[windowId].zones).forEach(zoneId => {
                    gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        const isCompleted = progress[charKey] || false;
                        
                        let matches = true;
                        
                        // åç§°æœç´¢
                        if (searchTerm && !char.name.toLowerCase().includes(searchTerm)) {
                            matches = false;
                        }
                        
                        // æœåŠ¡å™¨ç­›é€‰
                        if (serverFilter && char.server !== serverFilter) {
                            matches = false;
                        }
                        
                        // çŠ¶æ€ç­›é€‰
                        if (statusFilter) {
                            if (statusFilter === 'completed' && !isCompleted) {
                                matches = false;
                            } else if (statusFilter === 'pending' && isCompleted) {
                                matches = false;
                            }
                        }
                        
                        if (matches) {
                            filteredCharacters.push({
                                windowId,
                                zoneId,
                                charIndex,
                                char,
                                charKey,
                                isCompleted
                            });
                        }
                    });
                });
            });
            
            updateSearchResultsInfo();
            renderWindows();
        }

        function updateSearchResultsInfo() {
            const totalCharacters = getTotalCharacters();
            const filteredCount = filteredCharacters.length;
            const infoElement = document.getElementById('searchResultsInfo');
            
            if (isFiltering && filteredCount < totalCharacters) {
                infoElement.textContent = `æ˜¾ç¤º ${filteredCount}/${totalCharacters} ä¸ªè§’è‰²`;
                infoElement.style.display = 'block';
            } else {
                infoElement.style.display = 'none';
            }
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('serverFilter').value = '';
            document.getElementById('statusFilter').value = '';
            isFiltering = false;
            filteredCharacters = [];
            updateSearchResultsInfo();
            renderWindows();
        }

        // ==================== æ–°å¢åŠŸèƒ½ï¼šå¿«æ·é”®æ”¯æŒ ====================
        
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // é˜²æ­¢åœ¨è¾“å…¥æ¡†ä¸­è§¦å‘å¿«æ·é”®
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                const ctrl = e.ctrlKey || e.metaKey;
                
                if (ctrl && e.key === 'a') {
                    e.preventDefault();
                    selectAllTasks();
                } else if (ctrl && e.key === 'd') {
                    e.preventDefault();
                    clearAllTasks();
                } else if (ctrl && e.key === 's') {
                    e.preventDefault();
                    saveUserProgress();
                } else if (ctrl && e.key === 'Enter') {
                    e.preventDefault();
                    if (currentUser && currentUser.role === 'employee') {
                        submitProgress();
                    }
                } else if (ctrl && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                } else if (ctrl && e.key === 'n') {
                    e.preventDefault();
                    addWindow();
                } else if (ctrl && e.key === 'q') {
                    e.preventDefault();
                    logout();
                } else if (e.key === 'F1') {
                    e.preventDefault();
                    toggleShortcuts();
                }
            });
        }

        function toggleShortcuts() {
            const panel = document.getElementById('shortcutsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // ==================== æ–°å¢åŠŸèƒ½ï¼šç§»åŠ¨ç«¯æ”¯æŒ ====================
        
        function switchMobileTab(tab) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mobile-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ ¹æ®æ ‡ç­¾é¡µæ˜¾ç¤º/éšè—ç›¸åº”å†…å®¹
            const sections = {
                'tasks': ['.search-filter-section', '.backup-restore-section', '.windows-container'],
                'servers': ['.batch-server-controls'],
                'backup': ['.backup-restore-section'],
                'stats': ['.stats-grid']
            };
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.search-filter-section, .backup-restore-section, .batch-server-controls, .windows-container, .stats-grid').forEach(el => {
                el.style.display = 'none';
            });
            
            // æ˜¾ç¤ºé€‰ä¸­æ ‡ç­¾é¡µçš„å†…å®¹
            if (sections[tab]) {
                sections[tab].forEach(selector => {
                    document.querySelectorAll(selector).forEach(el => {
                        el.style.display = '';
                    });
                });
            }
        }

        // ==================== æ–°å¢åŠŸèƒ½ï¼šæ•°æ®å¤‡ä»½æ¢å¤ ====================
        
        function backupUserData() {
            const userData = {
                gameData: gameData,
                windowOrder: windowOrder,
                progress: progress,
                userPreferences: {
                    panelTitle: panelTitle,
                    welcomeMessage: welcomeMessage
                },
                backupTime: new Date().toISOString(),
                username: currentUser.username,
                version: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(userData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç”¨æˆ·æ•°æ®å¤‡ä»½_${currentUser.username}_${currentDate.replace(/\//g, '-')}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('âœ… ç”¨æˆ·æ•°æ®å¤‡ä»½æˆåŠŸï¼');
        }

        function restoreUserData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const userData = JSON.parse(e.target.result);
                    
                    if (confirm('ç¡®å®šè¦æ¢å¤æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰çš„æ‰€æœ‰æ•°æ®ï¼')) {
                        if (userData.gameData) gameData = userData.gameData;
                        if (userData.windowOrder) windowOrder = userData.windowOrder;
                        if (userData.progress) progress = userData.progress;
                        if (userData.userPreferences) {
                            if (userData.userPreferences.panelTitle) {
                                panelTitle = userData.userPreferences.panelTitle;
                                document.getElementById('employeePanelTitle').textContent = panelTitle;
                            }
                            if (userData.userPreferences.welcomeMessage) {
                                welcomeMessage = userData.userPreferences.welcomeMessage;
                                document.getElementById('welcomeText').innerHTML = welcomeMessage;
                            }
                        }
                        
                        saveUserProgress();
                        renderWindows();
                        updateAllProgress();
                        alert('âœ… æ•°æ®æ¢å¤æˆåŠŸï¼');
                    }
                } catch (error) {
                    alert('âŒ æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„å¤‡ä»½æ–‡ä»¶ï¼');
                }
            };
            reader.readAsText(file);
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            event.target.value = '';
        }

        // ==================== æ–°å¢åŠŸèƒ½ï¼šå¤šæ ¼å¼å¯¼å‡º ====================
        
        function exportToExcel() {
            let csvContent = 'ç»„æœº,å·æœº,è§’è‰²åç§°,æœåŠ¡å™¨,å®ŒæˆçŠ¶æ€,å®Œæˆæ—¶é—´\n';
            
            Object.keys(gameData).forEach(windowId => {
                Object.keys(gameData[windowId].zones).forEach(zoneId => {
                    gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        const isCompleted = progress[charKey] || false;
                        const completedTime = isCompleted ? new Date().toLocaleString() : '';
                        
                        csvContent += `${gameData[windowId].name},${gameData[windowId].zones[zoneId].name},${char.name},${char.server},${isCompleted ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'},${completedTime}\n`;
                    });
                });
            });
            
            // åˆ›å»ºExcelæ ¼å¼çš„CSVæ–‡ä»¶
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ä»»åŠ¡æ•°æ®_${currentUser.username}_${currentDate.replace(/\//g, '-')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('ğŸ“Š Excelæ ¼å¼æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        function exportToCSV() {
            let csvContent = 'ç»„æœº,å·æœº,è§’è‰²åç§°,æœåŠ¡å™¨,å®ŒæˆçŠ¶æ€\n';
            
            Object.keys(gameData).forEach(windowId => {
                Object.keys(gameData[windowId].zones).forEach(zoneId => {
                    gameData[windowId].zones[zoneId].characters.forEach((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        const isCompleted = progress[charKey] || false;
                        
                        csvContent += `${gameData[windowId].name},${gameData[windowId].zones[zoneId].name},${char.name},${char.server},${isCompleted ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}\n`;
                    });
                });
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ä»»åŠ¡æ•°æ®_${currentUser.username}_${currentDate.replace(/\//g, '-')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('ğŸ“‹ CSVæ ¼å¼æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        // ==================== ä¿®æ”¹ç°æœ‰å‡½æ•°ä»¥æ”¯æŒç­›é€‰ ====================
        
        // ä¿®æ”¹renderWindowså‡½æ•°ä»¥æ”¯æŒç­›é€‰æ˜¾ç¤º
        function renderWindows() {
            const container = document.getElementById('windowsContainer');
            container.innerHTML = '';

            windowOrder.forEach(windowId => {
                if (!gameData[windowId]) return;

                const windowDiv = document.createElement('div');
                windowDiv.className = 'window-card';
                windowDiv.draggable = true;
                windowDiv.dataset.windowId = windowId;
                
                // æ‹–æ‹½äº‹ä»¶
                windowDiv.addEventListener('dragstart', handleDragStart);
                windowDiv.addEventListener('dragover', handleDragOver);
                windowDiv.addEventListener('drop', handleDrop);
                windowDiv.addEventListener('dragend', handleDragEnd);

                const windowData = gameData[windowId];
                const windowCompleted = getWindowProgress(windowId);
                const windowTotal = getTotalCharactersInWindow(windowId);
                
                let zonesTabsHtml = '';
                let zonesContentHtml = '';
                
                Object.keys(windowData.zones).forEach((zoneId, index) => {
                    const zone = windowData.zones[zoneId];
                    const zoneProgress = getZoneProgress(windowId, zoneId);
                    const zoneTotal = zone.characters.length;
                    
                    zonesTabsHtml += `
                        <div class="zone-tab ${index === 0 ? 'active' : ''}" onclick="switchZone(${windowId}, '${zoneId}')">
                            <span class="zone-tab-content" ondblclick="editZoneName(${windowId}, '${zoneId}')" 
                                  id="zone-name-${windowId}-${zoneId}">${zone.name}</span>
                            <span class="zone-progress">(${zoneProgress}/${zoneTotal})</span>
                            <button class="zone-delete-btn" onclick="deleteZone(${windowId}, '${zoneId}')" 
                                    title="åˆ é™¤å·æœº">Ã—</button>
                        </div>
                    `;

                    const charactersHtml = zone.characters.map((char, charIndex) => {
                        const charKey = `${windowId}-${zoneId}-${charIndex}`;
                        const isCompleted = progress[charKey] || false;
                        
                        // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºæ­¤è§’è‰²ï¼ˆç­›é€‰åŠŸèƒ½ï¼‰
                        let shouldShow = true;
                        if (isFiltering) {
                            shouldShow = filteredCharacters.some(fc => 
                                fc.windowId == windowId && 
                                fc.zoneId == zoneId && 
                                fc.charIndex == charIndex
                            );
                        }
                        
                        if (!shouldShow) return '';
                        
                        return `
                            <div class="character-card ${isCompleted ? 'completed' : ''}">
                                <div class="character-header">
                                    <input type="checkbox" class="character-checkbox" id="${charKey}" 
                                           ${isCompleted ? 'checked' : ''} onchange="toggleCharacter('${charKey}')">
                                    <button class="character-delete" onclick="deleteCharacter(${windowId}, '${zoneId}', ${charIndex})" 
                                            title="åˆ é™¤è§’è‰²">Ã—</button>
                                </div>
                                <div class="character-server">${char.server}</div>
                                <div class="character-name" ondblclick="editCharacterName(${windowId}, '${zoneId}', ${charIndex})" 
                                     id="char-name-${windowId}-${zoneId}-${charIndex}">${char.name}</div>
                            </div>
                        `;
                    }).filter(html => html !== '').join('');

                    zonesContentHtml += `
                        <div class="zone-content ${index === 0 ? 'active' : ''}" id="zone-${windowId}-${zoneId}">
                            <div class="zone-controls">
                                <div class="zone-progress-info">${zone.name}: ${zoneProgress}/${zoneTotal}</div>
                                <div>
                                    <button class="btn btn-small btn-primary" onclick="selectZone(${windowId}, '${zoneId}')">å…¨é€‰</button>
                                    <button class="btn btn-small btn-secondary" onclick="clearZone(${windowId}, '${zoneId}')">æ¸…ç©º</button>
                                </div>
                            </div>
                            
                            <div class="server-select-container">
                                <span class="server-select-label">æœåŠ¡å™¨:</span>
                                <div class="custom-select">
                                    <div class="select-display" onclick="toggleServerSelect(${windowId}, '${zoneId}')">
                                        <span id="selected-server-${windowId}-${zoneId}">${zone.characters[0]?.server || systemData.serverList[0]}</span>
                                        <div class="select-arrow"></div>
                                    </div>
                                    <div class="select-options" id="server-options-${windowId}-${zoneId}">
                                        <input type="text" class="add-server-input" placeholder="è¾“å…¥æ–°æœåŠ¡å™¨åç§°åæŒ‰å›è½¦" 
                                               onkeypress="addServerOnEnter(event, ${windowId}, '${zoneId}')">
                                        ${systemData.serverList.map(server => `
                                            <div class="select-option ${server === (zone.characters[0]?.server || systemData.serverList[0]) ? 'selected' : ''}" 
                                                 onclick="selectServer(${windowId}, '${zoneId}', '${server}')">
                                                <span>${server}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="characters-grid">
                                ${charactersHtml}
                                <div class="add-character-btn" onclick="addCharacter(${windowId}, '${zoneId}')">
                                    â• æ·»åŠ è§’è‰²
                                </div>
                            </div>
                        </div>
                    `;
                });

                windowDiv.innerHTML = `
                    <div class="window-header">
                        <div class="window-title" ondblclick="editWindowName(${windowId})" 
                             id="window-name-${windowId}">${windowData.name}</div>
                        <div class="window-progress">${windowCompleted}/${windowTotal}</div>
                        <div class="window-controls">
                            <button class="btn btn-small btn-success" onclick="addZone(${windowId})">+å·æœº</button>
                            <button class="btn btn-small btn-primary" onclick="selectWindow(${windowId})">å…¨é€‰</button>
                            <button class="btn btn-small btn-secondary" onclick="clearWindow(${windowId})">æ¸…ç©º</button>
                            <button class="btn btn-small btn-danger" onclick="deleteWindow(${windowId})" title="åˆ é™¤ç»„æœº">Ã—</button>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="zones-tabs" id="tabs-${windowId}">
                            ${zonesTabsHtml}
                            <button class="zone-add-btn" onclick="addZone(${windowId})">+ å·æœº</button>
                        </div>
                        <div id="zones-${windowId}">
                            ${zonesContentHtml}
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                `;
                
                container.appendChild(windowDiv);
            });
        }

        // é¡µé¢åŠ è½½äº‹ä»¶
        window.onload = function() {
            init();
            initKeyboardShortcuts();
        };
    </script>
</body>
</html>